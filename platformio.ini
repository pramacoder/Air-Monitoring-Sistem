; =========================================
; PlatformIO Configuration File
; Air Quality Monitoring System - ESP32
; =========================================

; Common environment settings
[platformio]
default_envs = wokwi
description = Indoor Air Quality Monitoring System with ESP32
src_dir = src
include_dir = include

; =========================================
; Environment: Wokwi Simulator
; =========================================
[env:wokwi]
platform = espressif32
board = esp32dev
framework = arduino

; Serial Monitor Settings
monitor_speed = 115200
monitor_filters = 
    default
    time

; Library Dependencies
lib_deps = 
    adafruit/DHT sensor library@^1.4.6
    adafruit/Adafruit Unified Sensor@^1.1.14
    marcoschwartz/LiquidCrystal_I2C@^1.1.4

; Build Flags - Simplified untuk menghindari error
build_flags = 
    -DCORE_DEBUG_LEVEL=3
    -Os

; Wokwi specific settings
build_type = release

; =========================================
; Environment: Real ESP32 Hardware
; =========================================
[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino

; Upload Settings
upload_speed = 921600
upload_port = COM3  ; Ganti dengan port Anda (Windows: COMx, Linux/Mac: /dev/ttyUSBx)

; Serial Monitor Settings
monitor_speed = 115200
monitor_port = COM3  ; Sama dengan upload_port
monitor_filters = 
    default
    time
    esp32_exception_decoder

; Library Dependencies (sama seperti wokwi)
lib_deps = 
    adafruit/DHT sensor library@^1.4.6
    adafruit/Adafruit Unified Sensor@^1.1.14
    marcoschwartz/LiquidCrystal_I2C@^1.1.4

; Build Flags
build_flags = 
    -DCORE_DEBUG_LEVEL=3
    -DBOARD_HAS_PSRAM
    -Os
    -DARDUINO_USB_CDC_ON_BOOT=1

; Flash Settings
board_build.flash_mode = dio
board_build.partitions = default.csv

; =========================================
; Environment: OTA (Over-The-Air) Update
; =========================================
[env:esp32_ota]
extends = env:esp32dev
upload_protocol = espota
upload_port = 192.168.1.100  ; Ganti dengan IP ESP32 Anda
upload_flags = 
    --port=3232
    --auth=admin

; =========================================
; Build Options (Optional Advanced)
; =========================================
[env:esp32_optimized]
extends = env:esp32dev
build_flags = 
    ${env:esp32dev.build_flags}
    -O3
    -DPIO_FRAMEWORK_ARDUINO_ENABLE_EXCEPTIONS
    -ffast-math

; =========================================
; Test Environment
; =========================================
[env:test]
platform = native
test_framework = unity
lib_deps = 
    throwtheswitch/Unity@^2.5.2